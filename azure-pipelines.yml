trigger:
  batch: "true"
  branches:
    include:
      - master

pr:
  autoCancel: "true"
  branches:
    include:
      - master
      
jobs:

- job: ProdDeploy
  displayName: Production Deploy
  condition: and(succeeded(), eq(variables['Build.SourceBranch'], 'refs/heads/master'))
  steps:
  - powershell:

      $files = $(git diff HEAD HEAD~ --name-only);
      $temp = $files -split ' ';
      $count = $temp.Length;
      Write-Output "Total changed $count files";
      For ($i=0; $i -lt $temp.Length; $i++){
        $nameOfChangedFile = $temp[$i];
        echo "Changed File - $nameOfChangedFile";
      }

      $param = @{
          SmtpServer = '<a class="vglnk" href="http://smtp.gmail.com" rel="nofollow"><span>smtp</span><span>.</span><span>gmail</span><span>.</span><span>com</span></a>'
          Port = 587
          UseSsl = $true
          Credential  = 'vj.vivekjoshi@gmail.com'
          From = 'vj.vivekjoshi@gmail.com'
          To = 'vivek@infoglen.com'
          Subject = 'Sending emails through Gmail with Send-MailMessage'
          Body = "Check out the <a class="vglnk" href="http://PowerShellMagazine.com" rel="nofollow"><span>PowerShellMagazine</span><span>.</span><span>com</span></a> website!"
          Attachments = 'D:\articles.csv'
      }
 
      Send-MailMessage @param